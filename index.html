<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Twitter Tap : A python tool for collecting tweets in mongoDB using the search API" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Twitter Tap</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/janezkranjc/twitter-tap">View on GitHub</a>

          <h1 id="project_title">Twitter Tap</h1>
          <h2 id="project_tagline">A python tool for collecting tweets in mongoDB using the search API</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/janezkranjc/twitter-tap/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/janezkranjc/twitter-tap/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="twitter-tap" class="anchor" href="#twitter-tap"><span class="octicon octicon-link"></span></a>Twitter Tap</h1>

<p>Collect tweets to a mongoDB using the twitter search API.</p>

<h1>
<a name="about-twitter-tap" class="anchor" href="#about-twitter-tap"><span class="octicon octicon-link"></span></a>About Twitter Tap</h1>

<p>Twitter Tap is a python tool that connects to the Twitter API and issues calls to the <strong>search endpoint</strong> or the <strong>streaming API</strong> using a query that the user has entered. </p>

<h2>
<a name="using-the-search-api" class="anchor" href="#using-the-search-api"><span class="octicon octicon-link"></span></a>Using the search API</h2>

<p>If using the search API, the tool follows all the <strong>next_results</strong> links (with the corresponding <strong>max_id</strong>) so that all results are collected. When all the <strong>next_results</strong> links are exhausted the query is repeated using the <strong>since_id</strong> of the latest tweet from the results of the first query and follows all the <strong>next_results</strong> links again. The latest <strong>since_id</strong> is also stored in the database for each distinct query (query, geolocation, language), so that when the tool is restarted you will still only receive unique tweets.</p>

<p>Tweets are stored into a mongoDB, which has a unique index on the Tweet ID so that there is no duplication of data if more than 1 query is executed simultaneously.</p>

<p>There is an arbitrary wait time before each API call so that the rate limit is not reached. The default value of 2 seconds makes sure that there are no more than 450 requests per 15 minutes as is the rate limit of the search endpoint for authenticating with the app (not the user).</p>

<p>The tool can be run from the command line or be run as a daemon using supervisor (recommended). A sample supervisord.conf script is included with the tool.</p>

<h2>
<a name="using-the-streaming-api" class="anchor" href="#using-the-streaming-api"><span class="octicon octicon-link"></span></a>Using the streaming API</h2>

<p>You can also use the streaming API to store tweets. Storing tweets from the streaming API is much more straightforward, but you can only get the tweets you are currently streaming. Using the search API will also get you tweets from a couple of days back. Check out the documentation so that you can see what sorts of queries you can make with the search API vs the streaming API.</p>

<h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Install Twitter Tap using <a href="http://www.pip-installer.org/">pip</a></p>

<div class="highlight highlight-bash"><pre>pip install twitter-tap
</pre></div>

<p>Or, if you want the current code</p>

<div class="highlight highlight-bash"><pre>git clone git://github.com/janezkranjc/twitter-tap.git
<span class="nb">cd </span>twitter-tap
python setup.py install
</pre></div>

<h1>
<a name="before-you-start" class="anchor" href="#before-you-start"><span class="octicon octicon-link"></span></a>Before you start</h1>

<p>Please follow this link <a href="https://apps.twitter.com/">https://apps.twitter.com/</a> and create a twitter app. You will need the consumer key and consumer secret to access the twitter API.</p>

<h1>
<a name="using-twitter-tap" class="anchor" href="#using-twitter-tap"><span class="octicon octicon-link"></span></a>Using twitter tap</h1>

<p>Run Twitter Tap in the command line like this.</p>

<div class="highlight highlight-bash"><pre>tap
</pre></div>

<h3>
<a name="show-help-text" class="anchor" href="#show-help-text"><span class="octicon octicon-link"></span></a>Show help text</h3>

<div class="highlight highlight-bash"><pre>tap -h
</pre></div>

<div class="highlight highlight-bash"><pre>tap search -h
</pre></div>

<div class="highlight highlight-bash"><pre>tap stream -h
</pre></div>

<h3>
<a name="executing-a-query-with-the-search-api" class="anchor" href="#executing-a-query-with-the-search-api"><span class="octicon octicon-link"></span></a>Executing a query with the search API</h3>

<p>To execute a query you must provide a <strong>query</strong>, the <strong>consumer secret</strong> and either the <strong>consumer key</strong> or the access token. Consumer key and secret can be obtained at the <a href="http://apps.twitter.com/">http://apps.twitter.com/</a> website, while the access token will be obtained when first connecting with the key and secret.</p>

<div class="highlight highlight-bash"><pre>tap search --consumer-key CONSUMERKEY --consumer-secret CONSUMERSECRET -q <span class="s2">"miley cyrus"</span> -v DEBUG
</pre></div>

<p>Search options:</p>

<table>
<thead><tr>
<th>Option</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td>--query</td>
<td>A UTF-8 search query of 1,000 characters maximum, including operators. Queries may additionally be limited by complexity. Information on how to construct a query is available at <a href="https://dev.twitter.com/docs/using-search">https://dev.twitter.com/docs/using-search</a>
</td>
</tr>
<tr>
<td>--geocode</td>
<td>Returns tweets by users located within a given radius of the given latitude/longitude. The location is preferentially taking from the Geotagging API, but will fall back to their Twitter profile. The parameter value is specified by "latitude,longitude,radius", where radius units must be specified as either "mi" (miles) or "km" (kilometers). Note that you cannot use the near operator via the API to geocode arbitrary locations; however you can use this geocode parameter to search near geocodes directly. A maximum of 1,000 distinct "sub-regions" will be considered when using the radius modifier. Example value: 37.781157,-122.398720,1mi</td>
</tr>
<tr>
<td>--lang</td>
<td>Restricts tweets to the given language, given by an ISO 639-1 code. Language detection is best-effort. Example value: eu</td>
</tr>
<tr>
<td>--result-type</td>
<td>Specifies what type of search results you would prefer to receive. The current default is "mixed". Valid values include: "mixed" - Include both popular and real time results in the response. "recent" - return only the most recent results in the response. "popular" - return only the most popular results in the response.</td>
</tr>
<tr>
<td>--wait</td>
<td>Mandatory sleep time before executing a query. The default value is 2, which should ensure that the rate limit of 450 per 15 minutes is never reached.</td>
</tr>
<tr>
<td>--clean</td>
<td>Set this switch to use a clean since_id.</td>
</tr>
<tr>
<td>--consumer-key</td>
<td>The consumer key that you obtain when you create an app at <a href="https://apps.twitter.com/">https://apps.twitter.com/</a>
</td>
</tr>
<tr>
<td>--consumer-secret</td>
<td>The consumer secret that you obtain when you create an app at <a href="https://apps.twitter.com/">https://apps.twitter.com/</a>
</td>
</tr>
<tr>
<td>--access-token</td>
<td>You can use consumer_key and access_token instead of consumer_key and consumer_secret. This will make authentication faster, as the token will not be fetched. The access token will be printed to the standard output when connecting with the consumer_key and consumer_secret.</td>
</tr>
<tr>
<td>--db</td>
<td>MongoDB URI, example: mongodb://dbuser:dbpassword@localhost:27017/dbname Defaults to mongodb://localhost:27017/twitter</td>
</tr>
<tr>
<td>--queries-collection</td>
<td>The name of the collection for storing the highest since_id for each query. Default is queries.</td>
</tr>
<tr>
<td>--tweets-collection</td>
<td>The name of the collection for storing tweets. Default is tweets.</td>
</tr>
<tr>
<td>--verbosity</td>
<td>The level of verbosity. (DEBUG, INFO, WARN, ERROR, CRITICAL, FATAL)</td>
</tr>
</tbody>
</table><h3>
<a name="executing-a-query-with-the-streaming-api" class="anchor" href="#executing-a-query-with-the-streaming-api"><span class="octicon octicon-link"></span></a>Executing a query with the streaming API</h3>

<p>To execute a query you must provide a <strong>query</strong>, the <strong>consumer secret</strong> and either the <strong>consumer key</strong> or the access token. Consumer key and secret can be obtained at the <a href="http://apps.twitter.com/">http://apps.twitter.com/</a> website, while the access token will be obtained when first connecting with the key and secret.</p>

<div class="highlight highlight-bash"><pre>tap stream --consumer-key CONSUMERKEY --consumer-secret CONSUMERSECRET --access-token ACCESSTOKEN --access-token-secret ACCESSTOKENSECRET --track <span class="s2">"miley cyrus"</span> -v DEBUG
</pre></div>

<p>Streaming options:</p>

<table>
<thead><tr>
<th>Option</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td>--db</td>
<td>MongoDB URI, example: mongodb://dbuser:dbpassword@localhost:27017/dbname Defaults to mongodb://localhost:27017/twitter</td>
</tr>
<tr>
<td>--tweets-collection</td>
<td>The name of the collection for storing tweets. Default is tweets.</td>
</tr>
<tr>
<td>--follow</td>
<td>A comma separated list of user IDs, indicating the users to return statuses for in the stream. More information at <a href="https://dev.twitter.com/docs/streaming-apis/parameters#follow">https://dev.twitter.com/docs/streaming-apis/parameters#follow</a>
</td>
</tr>
<tr>
<td>--track</td>
<td>A comma separated list of keywords or phrases to track. Phrases of keywords are specified by a comma-separated list. More information at <a href="https://dev.twitter.com/docs/streaming-apis/parameters#track">https://dev.twitter.com/docs/streaming-apis/parameters#track</a>
</td>
</tr>
<tr>
<td>--locations</td>
<td>A comma-separated list of longitude,latitude pairs specifying a set of bounding boxes to filter Tweets by. On geolocated Tweets falling within the requested bounding boxes will be includedâ€”unlike the Search API, the user\'s location field is not used to filter tweets. Each bounding box should be specified as a pair of longitude and latitude pairs, with the southwest corner of the bounding box coming first. For example: "-122.75,36.8,-121.75,37.8" will track all tweets from San Francisco. NOTE: Bounding boxes do not act as filters for other filter parameters. More information at <a href="https://dev.twitter.com/docs/streaming-apis/parameters#locations">https://dev.twitter.com/docs/streaming-apis/parameters#locations</a>
</td>
</tr>
<tr>
<td>--firehose</td>
<td>Use this option to receive all public tweets if there are no keywords, users or locations to track. This requires special permission from Twitter. Otherwise a sample of 1% of tweets will be returned.</td>
</tr>
<tr>
<td>--consumer-key</td>
<td>The consumer key that you obtain when you create an app at <a href="https://apps.twitter.com/">https://apps.twitter.com/</a>
</td>
</tr>
<tr>
<td>--consumer-secret</td>
<td>The consumer secret that you obtain when you create an app at <a href="https://apps.twitter.com/">https://apps.twitter.com/</a>
</td>
</tr>
<tr>
<td>--access-token</td>
<td>You can generate your user access token at <a href="http://apps.twitter.com">http://apps.twitter.com</a> by clicking 'Create my access token'.</td>
</tr>
<tr>
<td>--access-token-secret</td>
<td>You can generate your user access token secret at <a href="http://apps.twitter.com">http://apps.twitter.com</a> by clicking 'Create my access token'.</td>
</tr>
<tr>
<td>--verbosity</td>
<td>The level of verbosity. (DEBUG, INFO, WARN, ERROR, CRITICAL, FATAL)</td>
</tr>
</tbody>
</table><h3>
<a name="where-are-the-tweets-stored" class="anchor" href="#where-are-the-tweets-stored"><span class="octicon octicon-link"></span></a>Where are the tweets stored</h3>

<p>The tweets are stored in the mongoDB in a collection called <strong>tweets</strong>. This can be changed using the --tweets-collection option. There is also a collection for saving the highest since_id for queries, which is <strong>queries</strong> by default (can be changed using the --queries-collection option).</p>

<h1>
<a name="running-as-a-daemon" class="anchor" href="#running-as-a-daemon"><span class="octicon octicon-link"></span></a>Running as a daemon</h1>

<p>To run Tap as a daemon you are encouraged to use supervisor. (Doesn't work natively under windows. You should use cygwin.)</p>

<p>Here is a sample supervisord.conf file for running tap</p>

<div class="highlight highlight-bash"><pre><span class="p">;</span> Sample supervisor config file <span class="k">for </span>daemonizing the twitter search to mongodb software

<span class="o">[</span>inet_http_server<span class="o">]</span>          <span class="p">;</span> inet <span class="o">(</span>TCP<span class="o">)</span> server disabled by default
<span class="nv">port</span><span class="o">=</span>127.0.0.1:9001         <span class="p">;</span> <span class="o">(</span>ip_address:port specifier, *:port <span class="k">for </span>all iface<span class="o">)</span>
<span class="nv">username</span><span class="o">=</span>manorastroman      <span class="p">;</span> <span class="o">(</span>default is no username <span class="o">(</span>open server<span class="o">))</span>
<span class="nv">password</span><span class="o">=</span>kingofthedragonmen <span class="p">;</span> <span class="o">(</span>default is no password <span class="o">(</span>open server<span class="o">))</span>

<span class="o">[</span>supervisord<span class="o">]</span>
<span class="nv">stopsignal</span><span class="o">=</span>INT
<span class="nv">logfile</span><span class="o">=</span>supervisord.log      <span class="p">;</span> <span class="o">(</span>main log file<span class="p">;</span>default <span class="nv">$CWD</span>/supervisord.log<span class="o">)</span>
<span class="nv">logfile_maxbytes</span><span class="o">=</span>50MB        <span class="p">;</span> <span class="o">(</span>max main logfile bytes b4 rotation<span class="p">;</span>default 50MB<span class="o">)</span>
<span class="nv">logfile_backups</span><span class="o">=</span>10           <span class="p">;</span> <span class="o">(</span>num of main logfile rotation backups<span class="p">;</span>default 10<span class="o">)</span>
<span class="nv">loglevel</span><span class="o">=</span>info                <span class="p">;</span> <span class="o">(</span>log level<span class="p">;</span>default info<span class="p">;</span> others: debug,warn,trace<span class="o">)</span>
<span class="nv">pidfile</span><span class="o">=</span>supervisord.pid      <span class="p">;</span> <span class="o">(</span>supervisord pidfile<span class="p">;</span>default supervisord.pid<span class="o">)</span>
<span class="nv">nodaemon</span><span class="o">=</span><span class="nb">false</span>               <span class="p">;</span> <span class="o">(</span>start in foreground <span class="k">if </span><span class="nb">true</span><span class="p">;</span>default <span class="nb">false</span><span class="o">)</span>
<span class="nv">minfds</span><span class="o">=</span>1024                  <span class="p">;</span> <span class="o">(</span>min. avail startup file descriptors<span class="p">;</span>default 1024<span class="o">)</span>
<span class="nv">minprocs</span><span class="o">=</span>200                 <span class="p">;</span> <span class="o">(</span>min. avail process descriptors<span class="p">;</span>default 200<span class="o">)</span>

<span class="o">[</span>rpcinterface:supervisor<span class="o">]</span>
supervisor.rpcinterface_factory <span class="o">=</span> supervisor.rpcinterface:make_main_rpcinterface

<span class="o">[</span>supervisorctl<span class="o">]</span>
<span class="nv">serverurl</span><span class="o">=</span>http://127.0.0.1:9001 <span class="p">;</span> use an http:// url to specify an inet socket
<span class="nv">username</span><span class="o">=</span>manorastroman       <span class="p">;</span> should be same as http_username <span class="k">if </span><span class="nb">set</span>
<span class="nv">password</span><span class="o">=</span>kingofthedragonmen  <span class="p">;</span> should be same as http_password <span class="k">if </span><span class="nb">set</span>

<span class="o">[</span>program:tapsearch<span class="o">]</span>
<span class="nb">command</span><span class="o">=</span>tap search --consumer-key CONSUMERKEY --consumer-secret CONSUMERSECRET -q <span class="s2">"miley cyrus"</span> -v DEBUG
<span class="nv">stdout_logfile</span><span class="o">=</span>tap_search.log
<span class="nv">stderr_logfile</span><span class="o">=</span>tap_err.log
<span class="nv">autostart</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">autorestart</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">startsecs</span><span class="o">=</span>10
<span class="nv">stopwaitsecs</span><span class="o">=</span>10

<span class="o">[</span>program:tapstream<span class="o">]</span>
<span class="nb">command</span><span class="o">=</span>tap stream --consumer-key CONSUMERKEY --consumer-secret CONSUMERSECRET --access-token ACCESSTOKEN --access-token-secret ACCESSTOKENSECRET --track <span class="s2">"miley cyrus"</span> -v DEBUG
<span class="nv">stdout_logfile</span><span class="o">=</span>tap_stream.log
<span class="nv">stderr_logfile</span><span class="o">=</span>tap_stream_err.log
<span class="nv">autostart</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">autorestart</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">startsecs</span><span class="o">=</span>10
<span class="nv">stopwaitsecs</span><span class="o">=</span>10

</pre></div>

<p>Afterwards you can start the daemon like this (you must be in the same folder as supervisord.conf or your supervisord.conf must be /etc/)</p>

<div class="highlight highlight-bash"><pre>supervisord
</pre></div>

<p>Open your browser to <a href="http://127.0.0.1:9001">http://127.0.0.1:9001</a> to see the status of the daemon.
By default the username is manorastroman and the password kingofthedragonmen.</p>

<p>Alternatively you can see the status like this</p>

<div class="highlight highlight-bash"><pre>supervisorctl status
</pre></div>

<p>Or see the tail of the logs (log file locations can be setup in supervisord.conf)</p>

<div class="highlight highlight-bash"><pre>supervisorctl tail tapsearch
</pre></div>

<div class="highlight highlight-bash"><pre>supervisorctl tail tapstream
</pre></div>

<p>Whenever you feel like shutting it down</p>

<div class="highlight highlight-bash"><pre>supervisorctl shutdown
</pre></div>

<h1>
<a name="useful-links" class="anchor" href="#useful-links"><span class="octicon octicon-link"></span></a>Useful links</h1>

<ul>
<li>
<strong>MongoDB</strong> <a href="https://www.mongodb.org/">https://www.mongodb.org/</a>
</li>
<li>
<strong>Twitter developers</strong> <a href="https://dev.twitter.com/">https://dev.twitter.com/</a>
</li>
<li>
<strong>Supervisor</strong> <a href="http://supervisord.org/">http://supervisord.org/</a>
</li>
</ul><h1>
<a name="changes" class="anchor" href="#changes"><span class="octicon octicon-link"></span></a>Changes</h1>

<p>v2.0.1:</p>

<ul>
<li>Fixed a bug where search results would fail to retreive tweets due to invalid since_id. The since_id is now manually computed.</li>
</ul><p>v2.0.0:</p>

<ul>
<li>This version now uses two commands - <strong>search</strong> and <strong>stream</strong>, to use either with the search API or the streaming API (on version 1.1.0 you could only use the search API).</li>
</ul><p>v1.1.0:</p>

<ul>
<li> Added two options for changing the default collection names for queries and tweets.</li>
</ul><p>v1.0.0:</p>

<ul>
<li> This version no longer reuqires a separate settings.py file as all options can be entered as command line arguments</li>
</ul><p>v0.1.0:</p>

<ul>
<li> Alpha release - this version needs a settings.py to enter credentials.</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Twitter Tap maintained by <a href="https://github.com/janezkranjc">janezkranjc</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-2921908-14");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
